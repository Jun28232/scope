# AIå¤–åŒ…å…¬å¸ç³»ç»Ÿ - æ ¸å¿ƒéª¨æ¶

åŸºäºSpring Boot 3.xçš„AIä»»åŠ¡ç¼–æ’ç³»ç»Ÿï¼Œå®ç°Dispatcher Agentæ‹†è§£ä»»åŠ¡å’ŒRole-based Agentæ‰§è¡Œæ¶æ„ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒç»„ä»¶
1. **Dispatcher Agent** - è‡ªç„¶è¯­è¨€ä»»åŠ¡æ‹†è§£
2. **AgentOrchestrator** - ä»»åŠ¡ç¼–æ’å’Œæ‰§è¡Œåè°ƒ
3. **Role-based Agents** - åŸºäºè§’è‰²çš„æ‰§è¡Œä»£ç†
4. **ProjectState** - å…¨å±€çŠ¶æ€ç®¡ç†å’ŒæŒä¹…åŒ–

### æŠ€æœ¯æ ˆ
- **æ ¸å¿ƒæ¡†æ¶**: Spring Boot 3.x + Spring AI
- **çŠ¶æ€æŒä¹…åŒ–**: Redis / æ•°æ®åº“
- **ä»»åŠ¡è°ƒåº¦**: è‡ªå®šä¹‰çŠ¶æ€æœºé€»è¾‘
- **ç¼–ç¨‹è¯­è¨€**: Java 17+

## ğŸ“ é¡¹ç›®ç»“æ„

```
src/main/java/com/aiteam/orchestrator/
â”œâ”€â”€ Task.java                    # ä»»åŠ¡å®ä½“ç±»
â”œâ”€â”€ ProjectPlan.java             # é¡¹ç›®è®¡åˆ’ç±»
â”œâ”€â”€ ProjectState.java            # é¡¹ç›®çŠ¶æ€ç®¡ç†
â”œâ”€â”€ Dispatcher.java              # Dispatcher Agentæ¥å£
â”œâ”€â”€ AgentOrchestrator.java       # ä»»åŠ¡ç¼–æ’å™¨
â”œâ”€â”€ RoleBasedAgent.java          # è§’è‰²ä»£ç†æ¥å£
â”œâ”€â”€ ProjectStateRepository.java  # çŠ¶æ€ä»“åº“æ¥å£
â””â”€â”€ AIOrchestrationApplication.java # ä¸»åº”ç”¨ç±»
```

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. ä»»åŠ¡æ‹†è§£ (Dispatcher)
- ä½¿ç”¨Spring AIçš„ChatClientå°†è‡ªç„¶è¯­è¨€è½¬æ¢ä¸ºç»“æ„åŒ–ä»»åŠ¡
- æ”¯æŒå¤šä»»åŠ¡æ‰¹é‡æ‹†è§£
- è‡ªåŠ¨ç”Ÿæˆä»»åŠ¡ä¾èµ–å…³ç³»

### 2. ä»»åŠ¡ç¼–æ’ (AgentOrchestrator)
- **ä¾èµ–æ£€æŸ¥**: ç¡®ä¿å‰ç½®ä»»åŠ¡å®Œæˆåæ‰æ‰§è¡Œå½“å‰ä»»åŠ¡
- **å•ç‚¹é‡è¯•**: ä»»åŠ¡å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ï¼Œæ”¯æŒé‡è¯•è®¡æ•°
- **çŠ¶æ€æŒä¹…åŒ–**: æ¯å®Œæˆä¸€ä¸ªä»»åŠ¡å°±ä¿å­˜çŠ¶æ€
- **æ–­ç‚¹ç»­ä¼ **: æ”¯æŒä»å¤±è´¥ç‚¹ç»§ç»­æ‰§è¡Œ

### 3. è§’è‰²ä»£ç† (Role-based Agents)
- **åç«¯ä»£ç†**: å¤„ç†åç«¯å¼€å‘ä»»åŠ¡
- **å‰ç«¯ä»£ç†**: å¤„ç†å‰ç«¯å¼€å‘ä»»åŠ¡
- **æµ‹è¯•ä»£ç†**: å¤„ç†æµ‹è¯•ç›¸å…³ä»»åŠ¡
- **æ¶æ„è®¾è®¡ä»£ç†**: å¤„ç†æ¶æ„è®¾è®¡ä»»åŠ¡

## ğŸ“‹ æ ¸å¿ƒæ¨¡å‹

### Task (ä»»åŠ¡)
- IDã€è§’è‰²ã€ä¾èµ–é¡¹ã€çŠ¶æ€ã€é‡è¯•è®¡æ•°
- æ”¯æŒçŠ¶æ€è½¬æ¢ï¼šPENDING â†’ RUNNING â†’ COMPLETED/FAILED

### ProjectPlan (é¡¹ç›®è®¡åˆ’)
- é¡¹ç›®å…ƒæ•°æ® + ä»»åŠ¡åˆ—è¡¨
- æä¾›ä¾èµ–å…³ç³»åˆ†æå’Œä»»åŠ¡ç­›é€‰

### ProjectState (é¡¹ç›®çŠ¶æ€)
- å…¨å±€ä¸Šä¸‹æ–‡ç»´æŠ¤
- å®æ—¶çŠ¶æ€è·Ÿè¸ªå’ŒæŒä¹…åŒ–
- æ”¯æŒRediså’Œæ•°æ®åº“ä¸¤ç§å­˜å‚¨æ–¹å¼

## ğŸ”§ é…ç½®è¯´æ˜

### 1. Spring AIé…ç½®
```yaml
spring:
  ai:
    openai:
      api-key: ${OPENAI_API_KEY}
      base-url: https://api.openai.com/v1
```

### 2. çŠ¶æ€å­˜å‚¨é…ç½®
```yaml
# Redisé…ç½®
spring:
  redis:
    host: localhost
    port: 6379

# æ•°æ®åº“é…ç½®
spring:
  datasource:
    url: jdbc:h2:mem:testdb
    driver-class-name: org.h2.Driver
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨åº”ç”¨
```bash
mvn spring-boot:run
```

### 2. ä½¿ç”¨ç¤ºä¾‹
```java
// åˆ›å»ºDispatcher
Dispatcher dispatcher = new Dispatcher(chatClientBuilder);

// æ‹†è§£è‡ªç„¶è¯­è¨€ä»»åŠ¡
ProjectPlan plan = dispatcher.decomposeTask("å¼€å‘ä¸€ä¸ªç”µå•†ç½‘ç«™");

// åˆ›å»ºç¼–æ’å™¨
AgentOrchestrator orchestrator = new AgentOrchestrator(stateRepository);

// æ‰§è¡Œé¡¹ç›®
orchestrator.executeProject(plan);
```

## ğŸ“Š çŠ¶æ€æµè½¬

```
PENDING â†’ RUNNING â†’ COMPLETED
               â†“
              FAILED â†’ RETRYING â†’ ... â†’ FAILED
```

## ğŸ”„ æ–­ç‚¹ç»­ä¼ 

```java
// ä»æŒ‡å®šçŠ¶æ€ç»§ç»­æ‰§è¡Œ
orchestrator.resumeExecution("project-id");
```

## ğŸ› ï¸ æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„è§’è‰²ä»£ç†
1. å®ç° `RoleBasedAgent` æ¥å£
2. åœ¨ `AgentOrchestrator` ä¸­æ³¨å†Œæ–°ä»£ç†
3. é…ç½®å¯¹åº”çš„æ‰§è¡Œé€»è¾‘

### è‡ªå®šä¹‰çŠ¶æ€å­˜å‚¨
1. å®ç° `ProjectStateRepository` æ¥å£
2. é…ç½®ç›¸åº”çš„ä¾èµ–é¡¹
3. æ›´æ–°åº”ç”¨é…ç½®æ–‡ä»¶

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **é‡è¯•ç­–ç•¥**: é»˜è®¤æœ€å¤§é‡è¯•æ¬¡æ•°ä¸º3æ¬¡
2. **çŠ¶æ€æŒä¹…åŒ–**: å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨Redisæˆ–æ•°æ®åº“
3. **å¼‚å¸¸å¤„ç†**: æ‰€æœ‰ä»£ç†æ‰§è¡Œå¤±è´¥éƒ½ä¼šè¢«æ•è·å¹¶é‡è¯•
4. **çº¿ç¨‹å®‰å…¨**: ä½¿ç”¨ConcurrentHashMapä¿è¯çº¿ç¨‹å®‰å…¨

---

*æœ¬ç³»ç»Ÿä¸ºAIå¤–åŒ…å…¬å¸çš„æ ¸å¿ƒä»»åŠ¡ç¼–æ’æ¡†æ¶ï¼Œå¯æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œæ‰©å±•å’Œå®šåˆ¶ã€‚*